<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Service Status — LoganGamesDaily</title>
  <meta name="description" content="Live and historical service status for LoganGamesDaily." />
  <style>
    :root {
      --bg: #0f1724;
      --muted: #98a0b3;
      --accent: #6ee7b7;
      --good: #16a34a;
      --degraded: #f59e0b;
      --down: #ef4444;
      --radius: 14px;
      color-scheme: dark;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      height: 100%;
      background: var(--bg);
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #e8eef7;
      display: flex;
      align-items: flex-start;
      justify-content: center;
      padding: 20px;
    }

    /* Animated glow background */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      background: radial-gradient(600px 400px at 50% 20%, rgba(110,231,183,0.06), transparent 70%);
      animation: pulseGlow 8s ease-in-out infinite alternate;
      z-index: 0;
    }
    @keyframes pulseGlow {
      0% { opacity: 0.4; transform: scale(1); }
      100% { opacity: 0.7; transform: scale(1.05); }
    }

    main {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 900px;
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
      border-radius: var(--radius);
      box-shadow: 0 8px 30px rgba(2,6,23,0.6);
      border: 1px solid rgba(255,255,255,0.04);
      padding: 28px 24px;
    }

    header {
      text-align: center;
      margin-bottom: 26px;
    }
    header h1 {
      font-size: 1.6rem;
      margin-bottom: 8px;
    }
    header p {
      color: var(--muted);
      font-size: 0.95rem;
      line-height: 1.45;
    }

    .services {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }

    .service {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
      padding: 12px 16px;
      border-radius: 10px;
      background: rgba(255,255,255,0.03);
      border: 1px solid rgba(255,255,255,0.04);
      flex-wrap: wrap;
    }

    .meta { flex: 1; min-width: 160px; }
    .name { font-weight: 600; }
    .url { color: var(--muted); font-size: 0.8rem; }

    .dot {
      width: 14px; height: 14px;
      border-radius: 50%;
      background: var(--muted);
      flex: 0 0 14px;
    }

    .status { min-width: 90px; font-weight: 600; text-align: right; }

    .spinner {
      width: 14px; height: 14px;
      border: 2px solid rgba(255,255,255,0.06);
      border-top-color: rgba(255,255,255,0.35);
      border-radius: 50%;
      animation: spin 0.9s linear infinite;
      display: inline-block;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 20px;
    }

    .tabs {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 16px;
    }
    .tab {
      background: rgba(110,231,183,0.1);
      border: 1px solid rgba(110,231,183,0.2);
      color: var(--accent);
      padding: 8px 14px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    .tab.active {
      background: rgba(110,231,183,0.2);
      box-shadow: 0 0 8px rgba(110,231,183,0.2);
    }

    .incidents {
      padding: 16px;
      background: rgba(255,255,255,0.02);
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.04);
    }
    .incident-item {
      background: rgba(0,0,0,0.1);
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 10px;
    }

    .calendar-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }
    .calendar-nav button {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: #e8eef7;
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
    }
    .calendar-nav input[type="date"] {
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      color: #e8eef7;
      border-radius: 6px;
      padding: 4px 8px;
    }

    @media (max-width: 700px) {
      main { padding: 20px; }
      .service { flex-direction: column; align-items: flex-start; }
      .status { text-align: left; margin-top: 6px; }
    }
  </style>
</head>
<body>
  <main role="main">
    <header>
      <h1>Service Status</h1>
      <p>Live status and incident history for LoganGamesDaily services.</p>
    </header>

    <section class="services" id="services"></section>

    <div class="tabs">
      <div class="tab active" id="tab-current">Current Incidents</div>
      <div class="tab" id="tab-past">Past Incidents</div>
    </div>

    <section class="incidents" id="incidents">
      <div id="currentIncidents">Loading incidents…</div>
      <div id="pastIncidents" style="display:none;">
        <div class="calendar-nav">
          <button id="prevDay">◀</button>
          <input type="date" id="datePicker" />
          <button id="nextDay">▶</button>
        </div>
        <div id="pastList">No incidents for this date.</div>
      </div>
    </section>

    <footer>Last checked: <span id="lastChecked">—</span></footer>
  </main>

  <script>
    const TARGETS = [
      { name: "logangamesdaily", label: "logangamesdaily.co.uk", url: "https://logangamesdaily.co.uk/" },
      { name: "systole", label: "systole.co.uk", url: "https://systole.co.uk/" }
    ];

    const servicesEl = document.getElementById('services');
    const lastCheckedEl = document.getElementById('lastChecked');
    const currentEl = document.getElementById('currentIncidents');
    const pastEl = document.getElementById('pastIncidents');
    const pastListEl = document.getElementById('pastList');
    const datePicker = document.getElementById('datePicker');

    TARGETS.forEach(t => {
      const wrap = document.createElement('div');
      wrap.className = 'service';
      wrap.id = 'svc-' + t.name;
      wrap.innerHTML = `
        <div class="dot"></div>
        <div class="meta">
          <div class="name">${t.label}</div>
          <div class="url">${t.url}</div>
        </div>
        <div class="status"><span class="spinner"></span></div>
      `;
      servicesEl.appendChild(wrap);
    });

    async function fetchWithTimeout(resource, options = {}) {
      const { timeout = 6000 } = options;
      return new Promise((resolve, reject) => {
        const timer = setTimeout(() => reject(new Error('timeout')), timeout);
        fetch(resource, { cache: 'no-store' })
          .then(r => { clearTimeout(timer); resolve(r); })
          .catch(e => { clearTimeout(timer); reject(e); });
      });
    }

    async function checkTarget(t) {
      const card = document.getElementById('svc-' + t.name);
      const dot = card.querySelector('.dot');
      const status = card.querySelector('.status');
      try {
        const resp = await fetchWithTimeout(t.url, { timeout: 7000 });
        const code = resp.status;
        if (code >= 200 && code < 300) {
          dot.style.background = 'var(--good)';
          status.textContent = '200 OK';
        } else if (code >= 300 && code < 400) {
          dot.style.background = 'var(--degraded)';
          status.textContent = 'Redirect';
        } else {
          dot.style.background = 'var(--down)';
          status.textContent = 'Error ' + code;
        }
      } catch {
        dot.style.background = 'var(--down)';
        status.textContent = 'Unreachable';
      }
    }

    async function runChecks() {
      lastCheckedEl.textContent = new Date().toLocaleString();
      for (const t of TARGETS) checkTarget(t);
    }

    async function loadCurrentIncidents() {
      try {
        const res = await fetch('/incidents.json');
        if (!res.ok) throw new Error();
        const data = await res.json();
        renderCurrent(data);
      } catch {
        currentEl.innerHTML = '<div class="incident-item"><strong>No active incidents</strong></div>';
      }
    }

    function renderCurrent(list) {
      if (!list || Object.keys(list).length === 0) {
        currentEl.innerHTML = '<div class="incident-item"><strong>No active incidents</strong></div>';
        return;
      }
      currentEl.innerHTML = '';
      Object.keys(list).forEach(k => {
        const path = list[k];
        const box = document.createElement('div');
        box.className = 'incident-item';
        box.textContent = 'Loading ' + path + '…';
        currentEl.appendChild(box);
        fetch(path).then(r => r.json()).then(i => {
          box.innerHTML = `<strong>${i.title}</strong><div class="small">${i.description || ''}</div><div class="small">${i.from || ''} → ${i.to || ''}</div>`;
        }).catch(() => {
          box.innerHTML = `<strong>${path}</strong><div class="small">Could not load incident file</div>`;
        });
      });
    }

    function loadPast(dateStr) {
      pastListEl.innerHTML = `<div class="small">Loading incidents for ${dateStr}…</div>`;
      fetch(`/incidents/${dateStr}.json`).then(r => r.json()).then(list => {
        if (!list.length) {
          pastListEl.innerHTML = `<div class="small">No incidents for ${dateStr}</div>`;
        } else {
          pastListEl.innerHTML = list.map(i => `<div class="incident-item"><strong>${i.title}</strong><div class="small">${i.description}</div><div class="small">${i.from} → ${i.to}</div></div>`).join('');
        }
      }).catch(() => {
        pastListEl.innerHTML = `<div class="small">No data for ${dateStr}</div>`;
      });
    }

    // Tabs
    const tabCurrent = document.getElementById('tab-current');
    const tabPast = document.getElementById('tab-past');
    tabCurrent.onclick = () => {
      tabCurrent.classList.add('active'); tabPast.classList.remove('active');
      currentEl.style.display = 'block'; pastEl.style.display = 'none';
    };
    tabPast.onclick = () => {
      tabPast.classList.add('active'); tabCurrent.classList.remove('active');
      currentEl.style.display = 'none'; pastEl.style.display = 'block';
      loadPast(datePicker.value || new Date().toISOString().split('T')[0]);
    };

    // Date navigation
    datePicker.value = new Date().toISOString().split('T')[0];
    document.getElementById('prevDay').onclick = () => {
      const d = new Date(datePicker.value); d.setDate(d.getDate() - 1);
      datePicker.value = d.toISOString().split('T')[0];
      loadPast(datePicker.value);
    };
    document.getElementById('nextDay').onclick = () => {
      const d = new Date(datePicker.value); d.setDate(d.getDate() + 1);
      datePicker.value = d.toISOString().split('T')[0];
      loadPast(datePicker.value);
    };
    datePicker.onchange = () => loadPast(datePicker.value);

    // Initial
    runChecks();
    loadCurrentIncidents();
    setInterval(runChecks, 90000);
  </script>
</body>
</html>